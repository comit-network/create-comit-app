# Roadmap to testnet

## Intro

Synced testnet nodes are a requirement for running the COMIT Node Daemon (cnd) against testnet. 
In order to make your life easier we provide fully synced testnet nodes for your cnd here:

Note that our testnet nodes might not always be running, but are just started before workshops/events.
If you have any questions please contact us through the [COMIT community chat on gitter](https://gitter.im/comit-network/community).

This guide assumes that you run both the taker and the maker on the same machine (for the example's sake).
In a more real world scenario maker and taker would of course be separate people on separate machines.

## Setup

### Run cnd taker

```toml
[network]
listen = ["/ip4/0.0.0.0/tcp/9939"]

[bitcoin]
network = "testnet"
node_url = "http://bobtimus.coblox.tech:18332"

[ethereum]
node_url = "http://bobtimus.coblox.tech:8545"

[http_api]
address = "0.0.0.0"
port = 8000
```

Example seed file for the taker:
```
-----BEGIN SEED-----
ZaBZdOwqLWHTLe9HXEc//wVGdt4VzVkDB/jB7tzkf/c=
-----END SEED-----
```

Startup command:
```
cnd --config taker_config.toml --seed-file taker_seed.pem
```

### Run cnd maker

```toml
[network]
listen = ["/ip4/0.0.0.0/tcp/19939"]

[bitcoin]
network = "testnet"
node_url = "http://bobtimus.coblox.tech:18332"

[ethereum]
node_url = "http://bobtimus.coblox.tech:8545"

[http_api]
address = "0.0.0.0"
port = 18000
```

Example seed file for the maker:
```
-----BEGIN SEED-----
AaBZdOwqLWHTLe9HXEc//wVGdt4VzVkDB/jB7tzkf/c=
-----END SEED-----
```

Startup command:
```
cnd --config maker_config.toml --seed-file maker_seed.pem
```

### Key/account generation and funding for both wallets

Keep in mind that when running both maker and taker on the same machine you have to create a Bitcoin and Ethereum account for both maker and taker, thus you have to create and fund **two Bitcoin** and **two Ethereum** accounts.

Configuration in `env` file (assuming that you run on both maker and taker from the same machine):

```
BITCOIN_HD_KEY_TAKER=EXTENDED_PRIVATE_KEY_GENERATED_BY_WAGYU
ETHEREUM_KEY_TAKER=ETHEREUM_PRIVATE_KEY_GENERATED_BY_WAGYU

BITCOIN_HD_KEY_MAKER=EXTENDED_PRIVATE_KEY_GENERATED_BY_WAGYU
ETHEREUM_KEY_MAKER=ETHEREUM_PRIVATE_KEY_GENERATED_BY_WAGYU

HTTP_URL_CND_TAKER=http://localhost:8000
HTTP_URL_CND_MAKER=http://localhost:18000

BITCOIN_P2P_URI=bobtimus.coblox.tech:18332
ETHEREUM_NODE_HTTP_URL=https://bobtimus.coblox.tech:8545
```

#### Bitcoin

1. Generate HD key (master-key) with [Wagyu](https://github.com/ArgusHQ/wagyu)
    1. `wagyu bitcoin hd --network testnet --derivation "m"`
2. Copy the `Extended Private Key` generated by Wagyu into the `env` file.
3. Generate an address to fund with [Wagyu](https://github.com/ArgusHQ/wagyu)
    1. `wagyu bitcoin import-hd --derivation "m/44'/1'/0'/0/0" --extended-private GENERATED-EXTENDED-PRIVATE-KEY`
    2. Fund the `Address` returned
4. Fund the address through a [Bitcoin testnet coin faucet](https://coinfaucet.eu/en/btc-testnet/)

#### Ethereum

1. Generate an Ethereum account with [Wagyu](https://github.com/ArgusHQ/wagyu)
    1. `wagyu ethereum hd`
2. Copy the `Private Key` (NOT the extended private key) to the env file.
3. Fund the account through an [Ethereum ropsten coin faucet](https://faucet.metamask.io/)

Note: Since Ethereum is account based there is no need to use the extended private key to derive multiple accounts.

## Run the example

To ensure that the swap works (assuming that you run maker and taker on one machine):
1. Both maker and taker cnd are running,
2. `env` file was properly initialized with the bitcoin HD keys and Ethereum private keys
3. Bitcoin addresses and Ethereum accounts were properly funded.


TO BE REMOVED:
* Start example, print balances of addresses, addresses are printed "Please fund: ..."
* If you don't have sufficient funds you may have to refund through a coin faucet.


## Appendix

### CoBloX Testnet Node Status

#### Ethereum
```
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_syncing","params":[],"id":1}' -H "Content-type:application/json" bobtimus.coblox.tech:8545 | jq .
```

Returns the syncing status.

#### Bitcoin
```
curl bobtimus.coblox.tech:18332/rest/chaininfo.json |  jq .
```

Returns basic chain status information.

### Wagyu details

#### Bitcoin

`wagyu bitcoin hd --network testnet --derivation "m"` results in:

```
      Path                 m
      Mnemonic             trim ship buddy eternal typical illegal juice wear daring fault virus bullet
      Extended Private Key tprv8ZgxMBicQKsPd33JokSLTqFLxhiJJfbhb3wjXw5z8C4UEjdWaghp72fDGkt9fSxVER9p2THzBMorQmcDJzX9YWHmEM7gFtnLHmrASgLqVKk
      Extended Public Key  tpubD6NzVbkrYhZ4WW56hQ6vsEuTXjEETzncAMYWpT8HYTrs5DtHD5XQHXH5SuF9w9hGA7QzHn85EtMywCEkMgfeC82GPmnhP2mB3oMFhytc86M
      Private Key          cVxtB2LvvEyGmsmwjDoxqTmnYDs8PZy1Q7iC1hFtchjNbLT9Lxva
      Public Key           03b48c55f7be5dfaf122cf83cfa7fb25c06f89eb1f3356e726699899c806525e8d
      Address              mq5EJnT1qskQnEk1F9hbtEZ8mGegu27gKY
      Format               p2pkh
      Network              testnet
      Compressed           true
```

The `Extended Private Key` (`tprv8ZgxM...`) is to be copied to the `env` file.

Then go on deriving an address from the extended private key by running 
`wagyu bitcoin import-hd --derivation "m/44'/1'/0'/0/0" --extended-private tprv8ZgxMBicQKsPd33JokSLTqFLxhiJJfbhb3wjXw5z8C4UEjdWaghp72fDGkt9fSxVER9p2THzBMorQmcDJzX9YWHmEM7gFtnLHmrASgLqVKk
`

Output:

```
      Path                 m/44'/1'/0'/0/0
      Extended Private Key tprv8kBtD22QdkPageXJ1DmnG5mND25Q77Yr4JEPWMqGcZz8FVaPMUZBuDj86C9jg2bLkdUUTs37XCpxESt53k3jeM18m1aBrzeT7PPW2cwHBb2
      Extended Public Key  tpubDGsvMS4en85Fa7Z5tsSNfVRUn3bLGSjkdbqAnssa2qnX5yq9ysNn5iLzGKVAD1VwALpp5w3BbdswRx6mePZP8uoNj4M3FqZnJ42LYJE9AYr
      Private Key          cR7GLt92Q118TaQrYhDmTt6XPg1F9d2ZANoHE5NrjMLyUsLbt9MK
      Public Key           029c62c978505cbf3f75e7a20b6b58aab1c4c35c122c056c0a2b39d9f2a97ab1ef
      Address              mryy8bDePgJk9rWaDXHtjgZKGECtFafkbY
      Format               p2pkh
      Network              testnet
      Compressed           true
```

Fund the `Address` through a coin faucet.

#### Ethereum

`wagyu ethereum hd` results in:

```
      Path                 m/44'/60'/0'/0
      Mnemonic             little act fluid problem luxury aware neglect way park man view dust
      Extended Private Key xprvA1TWewoaBzLZ2djQqZKkdYWKKqtYsnPfydJH34sPMwLCfLqPHXfGrwJp3Vyt4uL4mYQHgZaPGK81Y46jHHzsJ4xJj4bPwAqN1oEyimdLGUB
      Extended Public Key  xpub6ESs4TLU2MtrF7oswarkzgT3ssj3HF7XLrDsqTGzvGsBY9AXq4yXQjdHtp1YVfuisWwAr6Zg7nqwoapfjxo5KecZLA9aijwa1zgZLHvNPEY
      Private Key          5dd49f4439b1c746907ac7ed70bb5198f3889395b359d628ab821ef87aee6612
      Public Key           e8aef0ce418a2900ba1973c7288c50717ba284c5ccbe6e099fe39a439ea438e4e50678f3ebd3680b0be32488c3b88a73c3a5baedae2a17a9ac235b75fa80be05
      Address              0x2b2616535A92Ef11813c679CE12893682b40b003
```

The `Private Kez` (`5dd4...`) is to be copied to the `env` file. 
Fund the `Address` (`0x2b26...`) through the coin faucet.